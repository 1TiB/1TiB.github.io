{{- define "main" }}

<header class="page-header">
  <h1>{{ .Title }}</h1>
  {{- if .Description }}
  <div class="post-description">
    {{ .Description }}
  </div>
  {{- end }}
</header>

{{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}

{{- if .Site.Params.ShowAllPagesInArchive }}
{{- $pages = site.RegularPages }}
{{- end }}

{{- range $pages.GroupByPublishDate "2006" }}
{{- if ne .Key "0001" }}
{{ $year := .Key }}
{{ $month := "" }}
<div class="archive-year">
  <h2 class="archive-year-header">
    {{- replace $year "0001" "" }}<sup class="archive-count">&nbsp;&nbsp;{{ len .Pages }}</sup>
  </h2>
  {{- range .Pages.GroupByDate "January" }}
    {{ $month = .Key }}
    <div class="archive-month" data-key="{{ $year }}-{{ $month }}">
      <h3 class="archive-month-header" onclick="archives_toggle('{{ $year }}-{{ $month }}', this)">
        <span class="toggle">
          <svg class="lock" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 512 512">
            <path d="M363.908,212.282v-90.978C363.908,54.434,309.509,0,242.606,0c-66.884,0-121.302,54.434-121.302,121.304v90.978 c-33.498,0-60.653,27.158-60.653,60.648v151.629c0,33.5,27.155,60.653,60.653,60.653h242.604c33.491,0,60.653-27.153,60.653-60.653 V272.93C424.562,239.439,397.399,212.282,363.908,212.282z M257.77,359.257v50.139c0,8.382-6.781,15.163-15.163,15.163 c-8.382,0-15.164-6.781-15.164-15.163v-50.139c-8.9-5.269-15.161-14.57-15.161-25.673c0-16.765,13.579-30.327,30.324-30.327 c16.745,0,30.326,13.562,30.326,30.327C272.933,344.687,266.665,353.989,257.77,359.257z M303.255,212.282h-121.3v-90.978 c0-33.465,27.2-60.653,60.651-60.653c33.435,0,60.648,27.188,60.648,60.653V212.282z"/>
          </svg>
        </span>{{ $month }}<sup class="archive-count">&nbsp;&nbsp;{{ len .Pages }}</sup>
      </h3>
      <div class="archive-posts" id="{{ $year }}-{{ $month }}">
        {{- range .Pages }}
        {{- if eq .Kind "page" }}
        <div class="archive-entry">
          <h3 class="archive-entry-title">
            {{- .Title | markdownify }}
            {{- if .Draft }}<sup><span class="entry-isdraft">&nbsp;&nbsp;[draft]</span></sup>{{- end }}
          </h3>
          <div class="archive-meta">
            {{- partial "post_meta.html" . -}}
            {{- partial "post_tags.html" . -}}
          </div>
          <a class="entry-link" aria-label="post link to {{ .Title | plainify }}" href="{{ .Permalink }}"></a>
        </div>
        {{- end }}
        {{- end }}
      </div>
    </div>
    <script>
      if (localStorage.getItem("lock-archives-"+{{ $year }}+"-"+{{ $month }}) === "false") {
        document.getElementById({{ $year }}+"-"+{{ $month }}).style.display = "block";
      } else {
        document.getElementById({{ $year }}+"-"+{{ $month }}).style.display = "none";
      }
    </script>
  {{- end }}
</div>
{{- end }}
{{- end }}

{{- end }}{{/* end main */}}
